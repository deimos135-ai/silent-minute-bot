from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
import random
import datetime
import pytz

# ‚è∞ –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å ‚Äî –ö–∏—ó–≤
kyiv_tz = pytz.timezone("Europe/Kyiv")

# üîî –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –≤–∏–±—ñ—Ä
messages = [
    "üïØ –©–æ–¥–Ω—è –æ 9:00 ‚Äî —Ö–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è. –ó–≥–∞–¥–∞—î–º–æ –ì–µ—Ä–æ—ó–≤, —â–æ –≤—ñ–¥–¥–∞–ª–∏ –∂–∏—Ç—Ç—è –∑–∞ üá∫üá¶",
    "üïõ 9:00 ‚Äî —á–∞—Å –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è —ñ –≤—à–∞–Ω—É–≤–∞—Ç–∏ –ø–æ–ª–µ–≥–ª–∏—Ö. –ü–∞–º‚Äô—è—Ç–∞—î–º–æ. üíôüíõ",
    "üïØ –ú–æ–º–µ–Ω—Ç —Ç–∏—à—ñ. 9:00 ‚Äî —Ö–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è –∑–∞ —Ç–∏–º–∏, —Ö—Ç–æ –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤—Å—è –∑ –±–æ—é.",
    "üôè –û 9:00 ‚Äî –ø—Ä–∏—î–¥–Ω–∞–π—Å—è –¥–æ —Ö–≤–∏–ª–∏–Ω–∏ –º–æ–≤—á–∞–Ω–Ω—è. –í—ñ–¥–¥–∞–π —à–∞–Ω—É –Ω–∞—à–∏–º –ó–∞—Ö–∏—Å–Ω–∏–∫–∞–º.",
    "üïõ 9:00 ‚Äî —Å—Ö–∏–ª—ñ–º–æ –≥–æ–ª–æ–≤–∏ –≤ –ø–∞–º'—è—Ç—å –ø—Ä–æ —Ç–∏—Ö, —Ö—Ç–æ –∑–∞—Ö–∏—â–∞–≤ –Ω–∞—à—É —Å–≤–æ–±–æ–¥—É.",
    "üïØ –¶—ñ–Ω–∞ –º–∏—Ä—É ‚Äî –∂–∏—Ç—Ç—è –ì–µ—Ä–æ—ó–≤. 9:00 ‚Äî –∑—É–ø–∏–Ω–∏–º–æ—Å—å —ñ –≤—à–∞–Ω—É—î–º–æ.",
    "üïØ –í—à–∞–Ω—É–π–º–æ —Ç–∏—à–µ—é —Ç–∏—Ö, —Ö—Ç–æ –≤–∏–±–æ—Ä–æ–≤ –Ω–∞–º —Ä–∞–Ω–æ–∫. 9:00 ‚Äî —Ö–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è.",
    "üôè –ó—É–ø–∏–Ω–∏—Å—å –Ω–∞ –º–∏—Ç—å –æ 9:00. –ì–µ—Ä–æ—ó –Ω–µ –≤–º–∏—Ä–∞—é—Ç—å.",
    "üïõ 9:00 ‚Äî —Å–∏–º–≤–æ–ª—ñ—á–Ω–∞ —Ç–∏—à–∞. –ü–∞–º‚Äô—è—Ç–∞—î–º–æ –∫–æ–∂–Ω–æ–≥–æ, —Ö—Ç–æ –±–æ—Ä–æ–≤—Å—è –∑–∞ üá∫üá¶",
    "üïØ –ö–æ–∂–Ω–æ–≥–æ –¥–Ω—è –æ 9:00 ‚Äî –ø–∞–º‚Äô—è—Ç–∞—î–º–æ —Ç–∏—Ö, —Ö—Ç–æ –¥–∞–≤ –Ω–∞–º –Ω–æ–≤–∏–π –¥–µ–Ω—å."
]

def get_random_message():
    return random.choice(messages)

# ‚úâÔ∏è –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
async def send_messages(bot, chat_id):
    now_utc = datetime.datetime.utcnow().strftime('%H:%M:%S')
    now_kyiv = datetime.datetime.now(kyiv_tz).strftime('%H:%M:%S')
    text = get_random_message()
    try:
        print(f"[UTC {now_utc} | Kyiv {now_kyiv}] ‚è≥ –ù–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç {chat_id}")
        await bot.send_message(chat_id=chat_id, text=text)
        print(f"[Kyiv {now_kyiv}] ‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ")
    except Exception as e:
        print(f"[Kyiv {now_kyiv}] ‚ùå –ü–û–ú–ò–õ–ö–ê –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ: {e}")

# ‚è±Ô∏è –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫
async def setup_scheduler(bot, chat_id):
    scheduler = AsyncIOScheduler(timezone=kyiv_tz)

    # üïò –ë–æ–π–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî —â–æ–¥–Ω—è –∑ –ø–æ–Ω–µ–¥—ñ–ª–∫–∞ –ø–æ –ø‚Äô—è—Ç–Ω–∏—Ü—é –æ 08:55
    scheduler.add_job(
        send_messages,
        trigger=CronTrigger(day_of_week='mon-fri', hour=11, minute=15, timezone=kyiv_tz),
        args=[bot, chat_id]
    )

    scheduler.start()
